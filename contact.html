<section id="form-details">
    <form id="verification-form">
        <span>SECURITY CHECK</span>
        <h2>Confirm Your Identity</h2>
        <p>Please verify your email address to continue using our services.</p>
        
        <input type="text" id="user_name" placeholder="Full Name" required>
        <input type="email" id="user_email" placeholder="Email Address" required>
        
        <button type="button" class="normal" id="send-btn" onclick="sendCode()">Send Code</button>

        <div id="verif_section" style="display:none; margin-top: 20px; border-top: 1px solid #eee; pt: 20px;">
            <p style="color: #088178; font-size: 14px;">A 4-digit code has been sent to your inbox.</p>
            <input type="text" id="input_code" placeholder="Enter 4-digit code">
            <button type="button" class="normal" onclick="verifyIdentity()">Verify Identity</button>
        </div>
    </form>
</section>

<script>
    let generatedCode = null;

    function sendCode() {
        const email = document.getElementById('user_email').value;
        const name = document.getElementById('user_name').value || "User";

        if (!email.includes('@')) {
            alert("Please enter a valid email!");
            return;
        }

        // Генерируем код
        generatedCode = Math.floor(1000 + Math.random() * 9000).toString();

        const templateParams = {
            to_email: email,
            user_name: name,
            verification_code: generatedCode 
        };

        // Отправка через EmailJS
        emailjs.send('service_gmail', 'template_xxd560t', templateParams)
            .then(function() {
                alert("Code sent successfully!");
                document.getElementById('verif_section').style.display = 'block';
                document.getElementById('send-btn').innerText = "Resend Code";
            }, function(error) {
                alert("Error: Please check your EmailJS Service ID");
            });
    }

    function verifyIdentity() {
        const userEntered = document.getElementById('input_code').value;

        if (userEntered === generatedCode) {
            // ДЕЙСТВИЕ ПРИ УСПЕХЕ
            alert("Identity Confirmed! Welcome, " + document.getElementById('user_name').value);
            
            // Здесь ты можешь просто оставить пользователя на странице 
            // или скрыть форму и показать секретный контент:
            document.getElementById('verification-form').innerHTML = "<h2>Verification Successful</h2><p>Your identity has been verified. You can now browse the shop with full access.</p>";
            
        } else {
            alert("Incorrect code. Please try again.");
        }
    }
</script>
